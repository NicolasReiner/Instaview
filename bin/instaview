#!/usr/bin/env ruby
# frozen_string_literal: true

require_relative "../lib/instaview"

def show_usage
  puts "Usage: instaview <username|test> [method]"
  puts "Methods:"
  puts "  selenium (default) - Full browser automation with Selenium"
  puts "  http              - Simple HTTP method using curl"
  puts ""
  puts "Examples:"
  puts "  instaview test                      # Test gem functionality"
  puts "  instaview instagram"
  puts "  instaview instagram selenium"
  puts "  instaview instagram http"
end

username = ARGV[0]
method = ARGV[1] || "selenium"

if username.nil? || username.empty?
  show_usage
  exit 1
end

# Special case for testing
if username == "test"
  begin
    Instaview.test_connectivity
    exit 0
  rescue => e
    puts "Test failed: #{e.message}"
    exit 1
  end
end

unless %w[selenium http].include?(method)
  puts "Invalid method: #{method}"
  show_usage
  exit 1
end

begin
  case method
  when "selenium"
    puts "Using Selenium WebDriver method..."
    Instaview.scrape_instagram_stories(username)
  when "http"
    puts "Using simple HTTP method..."
    Instaview.scrape_with_simple_http(username)
  end
rescue => e
  puts "Error: #{e.message}"
  if method == "selenium"
    puts ""
    puts "If you're having Chrome/Selenium issues, try:"
    puts "  1. Run: ./bin/setup_selenium"
    puts "  2. Or use HTTP method: instaview #{username} http"
  end
  exit 1
end